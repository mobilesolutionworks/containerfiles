name: work

# Triggers for when the workflow will run
on:
  push:
    branches: [ main, develop ]

jobs:
  ubuntu-lunar:
    name: ubuntu-lunar
    runs-on: self-hosted
    container:
      image: docker.funf/docker:dind
      options: --privileged
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Build
        run: |
          cd ubuntu-lunar
          echo "jenkins" | docker login registry.funf -u jenkins --password-stdin 
          docker build --compress --pull --rm -t registry.funf/build/ubuntu-lunar . --file Containerfile
          docker push registry.funf/build/ubuntu-lunar

  oraclelinux9:
    name: oraclelinux9
    runs-on: self-hosted
    container:
      image: docker.funf/docker:dind
      options: --privileged
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Build
        run: |
          cd oraclelinux9
          echo "jenkins" | docker login registry.funf -u jenkins --password-stdin 
          docker build --compress --pull --rm -t registry.funf/build/oraclelinux9 . --file Containerfile
          docker push registry.funf/build/oraclelinux9

  oraclelinux9-pkg:
    name: oraclelinux9-pkg
    needs: [ oraclelinux9 ]
    runs-on: self-hosted
    container:
      image: docker.funf/docker:dind
      options: --privileged
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Build
        run: |
          cd oraclelinux9-pkg
          echo "jenkins" | docker login registry.funf -u jenkins --password-stdin 
          docker build --compress --pull --rm -t registry.funf/build/oraclelinux9-pkg . --file Containerfile
          docker push registry.funf/build/oraclelinux9-pkg
